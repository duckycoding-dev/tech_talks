---
/**
 * Modern CSS Carousel — zero JavaScript
 *
 * Uses scroll-snap for item snapping, and the new CSS pseudo-elements
 * for native navigation (Chrome 135+):
 *   - ::scroll-button(inline-start / inline-end) — prev/next buttons
 *   - ::scroll-marker() — dot indicators
 *   - :target-current — active marker state
 *
 * Falls back gracefully to a swipeable scroll-snap carousel in other browsers.
 * Scroll-driven animations provide a scale/opacity effect as items enter view.
 */
import type { CollectionEntry } from 'astro:content';
import ShipCard from './ShipCard.astro';

interface Props {
  ships: CollectionEntry<'ships'>[];
}

const { ships } = Astro.props;
---

<div class="modern-carousel-container">
  <ul
    class="carousel"
    role="list"
  >
    {ships.map((ship, i) => (
      <li class="carousel-slide">
        <ShipCard
          ship={ship}
          isActive={i === 0}
        />
      </li>
    ))}
  </ul>
</div>

<style is:global>
  .modern-carousel-container {
    margin-bottom: 1.5rem;
  }

  /* ── Scroll-snap track ── */
  .carousel {
    display: grid;
    grid-auto-flow: column;
    gap: 1rem;
    list-style: none;
    anchor-name: --trip-carousel;
    overflow-y: visible;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    scroll-behavior: smooth;
    padding-block: 2rem;

    /* Ensure center-snapping leaves space on edges */
    scroll-padding-inline: calc(50% - 110px);
  }

  .carousel::-webkit-scrollbar {
    display: none;
  }

  /* ── Slide items ── */
  .carousel-slide {
    width: max-content;
    min-width: 220px;
    scroll-snap-align: center;
    transition:
      transform 0.3s ease,
      opacity 0.3s ease;
  }

  /* ── Native scroll buttons (Chrome 135+) ── */
  @supports selector(::scroll-button(inline-start)) {
    .carousel {
      /* Enable marker group below the track */
      scroll-marker-group: after;
      scrollbar-width: none;

      &:before,
      &:after {
        content: '';
        display: block;
        inline-size: 50cqi;
      }
    }

    .carousel::scroll-button(inline-start) {
      position-area: left;
      margin-inline-start: 2rem;
      content: '‹';
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      border: 1px solid rgba(255, 255, 255, 0.2);
      background: var(--color-card);
      color: var(--color-heading);
      font-size: 1.4rem;
      cursor: pointer;
      transition:
        border-color 0.2s,
        background 0.2s;
    }

    .carousel::scroll-button(inline-end) {
      position-area: right;
      margin-inline-end: 2rem;
      content: '›';
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      border: 1px solid rgba(255, 255, 255, 0.2);
      background: var(--color-card);
      color: var(--color-heading);
      font-size: 1.4rem;
      cursor: pointer;
      transition:
        border-color 0.2s,
        background 0.2s;
    }

    .carousel::scroll-button(*) {
      position: absolute;
      position-anchor: --trip-carousel;
    }

    .carousel::scroll-button(inline-start):hover,
    .carousel::scroll-button(inline-end):hover {
      border-color: var(--accent);
      background: rgba(56, 189, 248, 0.1);
    }

    .carousel::scroll-button(inline-start):disabled,
    .carousel::scroll-button(inline-end):disabled {
      opacity: 0.3;
      cursor: default;
    }

    /* ── Native scroll markers (dot indicators) ── */
    .carousel::scroll-marker-group {
      display: flex;
      justify-content: center;
      gap: 0.4rem;
    }

    .carousel-slide::scroll-marker {
      content: '';
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      border: none;
      cursor: pointer;
      transition: background 0.2s;
    }

    .carousel-slide::scroll-marker:hover {
      background: rgba(56, 189, 248, 0.5);
    }

    .carousel-slide::scroll-marker:target-current {
      background: var(--accent);
    }
  }

  @media (max-width: 640px) {
    .carousel-slide {
      width: 220px;
    }

    .carousel {
      margin-right: calc(
        -1 *
        2rem
      ); /* Overflow main page padding on smaller devices */
      margin-left: calc(
        -1 *
        2rem
      ); /* Overflow main page padding on smaller devices */
      scroll-padding-inline: calc(50% - 90px);
    }
  }

  /* ── Scroll-driven animations (Chrome 115+) ── */
  @supports (animation-timeline: view()) {
    .carousel-slide {
      animation: slide-in-view linear both;
      animation-timeline: view(inline);
    }

    @keyframes slide-in-view {
      /* Entering from far edge */
      0% {
        opacity: 0.3;
        transform: scale(0.8);
      }
      /* Fully in view (center) */
      40% {
        opacity: 1;
        transform: scale(1);
      }
      60% {
        opacity: 1;
        transform: scale(1);
      }
      /* Exiting to far edge */
      100% {
        opacity: 0.3;
        transform: scale(0.8);
      }
    }
  }
</style>
