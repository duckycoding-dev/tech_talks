---
import type { CollectionEntry } from 'astro:content';
import ShipCard from './ShipCard.astro';

interface Props {
  ships: CollectionEntry<'ships'>[];
}

const { ships } = Astro.props;

const n = ships.length;
const angleStep = 360 / n;
// Radius: enough arc spacing between cards so they don't overlap
// For small counts use a minimum, for large counts scale with count
const cardWidth = 200;
const radius = Math.max(280, Math.round((n * cardWidth) / (2 * Math.PI) + 30));
---

<div class="carousel-container">
  <div class="carousel-wrapper">
    <button
      class="nav-btn prev"
      data-carousel-prev
      aria-label="Previous ship"
      >‹</button
    >

    <div class="carousel-scene">
      <div
        class="carousel-ring"
        data-carousel-ring
        data-count={n}
        data-angle-step={angleStep}
        style={`--rotation: 0deg; --radius: ${radius}px`}
      >
        {ships.map((ship, i) => {
          const angle = angleStep * i;
          return (
            <div
              class="carousel-item"
              style={`transform: rotateY(${angle}deg) translateZ(var(--radius))`}
            >
              <ShipCard
                ship={ship}
                isActive={i === 0}
              />
            </div>
          );
        })}
      </div>
    </div>

    <button
      class="nav-btn next"
      data-carousel-next
      aria-label="Next ship"
      >›</button
    >
  </div>

  <div
    class="carousel-indicator"
    data-carousel-dots
  >
    {ships.map((_, i) => (
      <button
        class:list={['dot', { active: i === 0 }]}
        data-dot-index={i}
        aria-label={`Go to ship ${i + 1}`}
      ></button>
    ))}
  </div>
</div>

<script
  is:inline
  data-astro-rerun
></script>

<style></style>
